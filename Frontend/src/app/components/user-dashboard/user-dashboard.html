<!-- user-dashboard -->
<div class="dashboard-container" role="main" aria-label="User Dashboard">
  <app-header
    [userName]="displayUserName"
    [title]="'Dashboard'"
    [buttons]="headerButtons"
    (buttonClick)="handleHeaderAction($event)"
  >
  </app-header>

  <section class="events-section" aria-labelledby="events-section-title">
    <div class="section-header">
      <h2 class="section-title" id="events-section-title">
        <span class="title-icon" aria-hidden="true">ğŸ‰</span>
        Available Events
        <div class="title-underline" aria-hidden="true"></div>
      </h2>
    </div>

    <!-- No Results Message -->
    <div
      *ngIf="(events?.length || 0) === 0"
      class="no-results"
      role="status"
      aria-live="polite"
    >
      <div class="no-results-icon" aria-hidden="true">ğŸ”</div>
      <h3 class="no-results-title">No events found</h3>
      <p class="no-results-message">
        Try adjusting your search criteria or filters to find more events.
      </p>
      <button
        class="clear-filters-btn"
        (click)="clearFilters()"
        aria-label="Clear all filters to show more events"
      >
        <span class="btn-icon" aria-hidden="true">ğŸ”„</span>
        <span class="btn-text">Clear All Filters</span>
      </button>
    </div>

    <!-- Events Grid - Updated to use paginatedEvents -->
    <div
      class="events-grid"
      *ngIf="events.length > 0"
      role="grid"
      aria-label="Available events"
    >
      <div
        *ngFor="let event of paginatedEvents"
        class="event-card"
        [class.registered-card]="isRegistered(event.id)"
        role="gridcell"
        [attr.aria-label]="'Event: ' + event.title + ', ' + (isRegistered(event.id) ? 'Already booked' : 'Available to book')"
      >
        <div class="card-gradient-bg" aria-hidden="true"></div>
        <div class="card-content">
          <div class="card-header">
            <h3 class="event-title">{{ event.title }}</h3>
            <div class="event-category" aria-label="Event category">
              {{ event.category || 'Event' }}
            </div>
          </div>
          <p class="event-description">{{ event.description }}</p>

          <div class="event-details" aria-label="Event details">
            <div class="detail-item">
              <span class="detail-icon" aria-hidden="true">ğŸ“…</span>
              <span class="detail-label">Date:</span>
              <span class="detail-value"
                >{{ event.date | date: 'MMM d, y'}}</span
              >
            </div>
            <div class="detail-item">
              <span class="detail-icon" aria-hidden="true">â°</span>
              <span class="detail-label">Time:</span>
              <span class="detail-value">{{ event.timeSlot }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon" aria-hidden="true">ğŸ“</span>
              <span class="detail-label">Location:</span>
              <span class="detail-value">{{ event.tempCity }}</span>
            </div>
            <div class="detail-item price-item">
              <span class="detail-icon" aria-hidden="true">ğŸ’°</span>
              <span class="detail-label">Price:</span>
              <span class="price-value">â‚¹{{ event.price }}</span>
            </div>
          </div>

          <div class="card-actions" role="group" aria-label="Event actions">
            <button
              class="register-btn"
              (click)="registerForEvent(event.id)"
              [disabled]="isRegistered(event.id)"
              [class.registered-btn]="isRegistered(event.id)"
              [attr.aria-label]="isRegistered(event.id) ? 'Event already booked for ' + event.title : 'Book now for ' + event.title"
              [attr.aria-pressed]="isRegistered(event.id)"
            >
              <span class="register-btn-content">
                <span class="btn-icon" aria-hidden="true"
                  >{{ isRegistered(event.id) ? 'âœ“' : '+' }}</span
                >
                <span class="register-btn-text"
                  >{{ isRegistered(event.id) ? 'Booked' : 'Book Now' }}</span
                >
              </span>
              <div class="btn-ripple" aria-hidden="true"></div>
            </button>

            <!-- View Details Button -->
            <button
              class="view-details-btn"
              (click)="showEventDetail(event)"
              [attr.aria-label]="'View details for ' + event.title"
            >
              <!-- <span class="btn-icon">ğŸ‘ï¸</span> -->
              <span class="btn-text">Details</span>
            </button>
          </div>
        </div>
        <div class="card-shine" aria-hidden="true"></div>
      </div>
    </div>

    <app-pagination
      [currentPage]="currentPage"
      [totalPages]="totalPages"
      (pageChanged)="onPageChange($event)"
      aria-label="Events pagination"
    >
    </app-pagination>
  </section>

  <!-- Event Details Modal -->
  <div
    class="modal-overlay"
    *ngIf="showEventDetails"
    (click)="closeEventDetails()"
    role="dialog"
    aria-modal="true"
    [attr.aria-labelledby]="'modal-title-' + selectedEvent?.id"
    aria-describedby="modal-description"
  >
    <div class="event-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title" [id]="'modal-title-' + selectedEvent?.id">
          {{ selectedEvent?.title }}
        </h2>
        <button
          class="modal-close-btn"
          (click)="closeEventDetails()"
          aria-label="Close event details"
        >
          <span aria-hidden="true">âœ•</span>
        </button>
      </div>

      <div class="modal-content" *ngIf="selectedEvent" id="modal-description">
        <div class="modal-category">
          <span class="category-badge" aria-label="Event category"
            >{{ selectedEvent.category || 'Event' }}</span
          >
        </div>
        <button
          class="share-btn"
          (click)="copyEventToClipboard()"
          aria-label="Copy event details to clipboard"
        >
          <span aria-hidden="true">ğŸ“‹</span> Share
        </button>
        <div class="modal-description">
          <h3>About This Event</h3>
          <p>{{ selectedEvent.description }}</p>
        </div>

        <div class="modal-details-grid" role="group" aria-label="Event details">
          <div class="modal-detail-card">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ“…</span>
              <span class="detail-title">Date & Time</span>
            </div>
            <div class="detail-content">
              <p>
                <strong>Date:</strong> {{ selectedEvent.date | date: 'MMM d, y'
                }}
              </p>
              <p><strong>Time:</strong> {{ selectedEvent.timeSlot }}</p>
              <p><strong>Duration:</strong> {{ selectedEvent.duration }}</p>
            </div>
          </div>

          <div class="modal-detail-card">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ“</span>
              <span class="detail-title">Location</span>
            </div>
            <div class="detail-content">
              <p>{{ getFullAddress(selectedEvent.location) }}</p>
            </div>
          </div>

          <div class="modal-detail-card">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ’°</span>
              <span class="detail-title">Pricing</span>
            </div>
            <div class="detail-content">
              <p class="price-highlight">â‚¹{{ selectedEvent.price }}</p>
            </div>
          </div>

          <div class="modal-detail-card">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ‘¥</span>
              <span class="detail-title">Capacity</span>
            </div>
            <div class="detail-content">
              <p>Max {{ selectedEvent.maxRegistrations }} attendees</p>
            </div>
          </div>

          <div class="modal-detail-card" *ngIf="selectedEvent.artist">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ­</span>
              <span class="detail-title">Artist</span>
            </div>
            <div class="detail-content">
              <p>{{ selectedEvent.artist }}</p>
            </div>
          </div>

          <div class="modal-detail-card" *ngIf="selectedEvent.organization">
            <div class="detail-header">
              <span class="detail-icon" aria-hidden="true">ğŸ¢</span>
              <span class="detail-title">Organization</span>
            </div>
            <div class="detail-content">
              <p>{{ selectedEvent.organization }}</p>
            </div>
          </div>
        </div>

        <div class="modal-actions">
          <button
            class="modal-register-btn"
            (click)="registerForEvent(selectedEvent.id)"
            [disabled]="isRegistered(selectedEvent.id)"
            [class.registered-btn]="isRegistered(selectedEvent.id)"
            [attr.aria-label]="isRegistered(selectedEvent.id) ? 'Event already booked for ' + selectedEvent.title : 'Book now for ' + selectedEvent.title"
            [attr.aria-pressed]="isRegistered(selectedEvent.id)"
          >
            <span class="btn-icon" aria-hidden="true"
              >{{ isRegistered(selectedEvent.id) ? 'âœ“' : '+' }}</span
            >
            <span class="btn-text"
              >{{ isRegistered(selectedEvent.id) ? 'Booked' : 'Book Now'
              }}</span
            >
          </button>
        </div>
      </div>
    </div>
  </div>

  <app-custom-alert
    [alertData]="customAlert"
    [autoCloseDuration]="2000"
    (alertClosed)="closeAlert()"
    (alertConfirmed)="handleAlertConfirm()"
    (alertCancelled)="handleAlertCancel()"
  >
  </app-custom-alert>

  <app-footer
    brandName="Happenin'"
    contactEmail="happenin.events.app@gmail.com"
    [showSocials]="false"
  >
  </app-footer>

  <!-- Custom Alert/Confirmation Modal -->
  <div
    class="custom-alert-overlay"
    *ngIf="customAlert.show"
    (click)="closeAlert()"
    role="dialog"
    aria-modal="true"
    aria-labelledby="alert-title"
    aria-describedby="alert-message"
  >
    <div
      class="custom-alert-modal"
      (click)="$event.stopPropagation()"
      [class.alert-success]="customAlert.type === 'success'"
      [class.alert-error]="customAlert.type === 'error'"
      [class.alert-warning]="customAlert.type === 'warning'"
      [class.alert-info]="customAlert.type === 'info'"
      [class.alert-confirm]="customAlert.type === 'confirm'"
    >
      <!-- Alert Header -->
      <div class="custom-alert-header">
        <div class="alert-icon-container">
          <div
            class="alert-icon"
            [attr.aria-label]="customAlert.type + ' alert'"
          >
            <span *ngIf="customAlert.type === 'success'" aria-hidden="true"
              >âœ…</span
            >
            <span *ngIf="customAlert.type === 'error'" aria-hidden="true"
              >âŒ</span
            >
            <span *ngIf="customAlert.type === 'warning'" aria-hidden="true"
              >âš ï¸</span
            >
            <span *ngIf="customAlert.type === 'info'" aria-hidden="true"
              >â„¹ï¸</span
            >
            <span *ngIf="customAlert.type === 'confirm'" aria-hidden="true"
              >â“</span
            >
          </div>
        </div>
        <div class="alert-title-container">
          <h3 class="alert-title" id="alert-title">{{ customAlert.title }}</h3>
          <button
            class="alert-close-btn"
            (click)="closeAlert()"
            aria-label="Close alert"
          >
            <span aria-hidden="true">âœ•</span>
          </button>
        </div>
      </div>

      <!-- Alert Content -->
      <div class="custom-alert-content">
        <p class="alert-message" id="alert-message">
          {{ customAlert.message }}
        </p>
      </div>

      <!-- Alert Actions -->
      <div class="custom-alert-actions" role="group" aria-label="Alert actions">
        <!-- Show OK button only if autoClose is false -->
        <button
          *ngIf="customAlert.type !== 'confirm' && !customAlert.autoClose"
          class="alert-btn alert-ok-btn"
          (click)="closeAlert()"
          aria-label="Acknowledge alert"
        >
          <span class="btn-text">OK</span>
          <div class="btn-ripple" aria-hidden="true"></div>
        </button>

        <div
          *ngIf="customAlert.type === 'confirm'"
          class="confirmation-buttons"
          role="group"
          aria-label="Confirmation options"
        >
          <button
            class="alert-btn alert-cancel-btn"
            (click)="handleAlertCancel()"
            aria-label="Cancel action"
          >
            <span class="btn-text">Cancel</span>
            <div class="btn-ripple" aria-hidden="true"></div>
          </button>
          <button
            class="alert-btn alert-confirm-btn"
            (click)="handleAlertConfirm()"
            aria-label="Confirm action"
          >
            <span class="btn-text">Confirm</span>
            <div class="btn-ripple" aria-hidden="true"></div>
          </button>
        </div>
      </div>

      <!-- Animated border -->
      <div class="alert-border-animation" aria-hidden="true"></div>
    </div>
  </div>
  <router-outlet></router-outlet>
</div>
